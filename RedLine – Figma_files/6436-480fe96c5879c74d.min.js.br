"use strict";
!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},n=(new Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="d61f0649-101d-5997-a346-325986314da9")}catch(e){}}();
(globalThis.webpackChunk_figma_web_bundler=globalThis.webpackChunk_figma_web_bundler||[]).push([[6436],{166436:(t,e,n)=>{n.d(e,{iX:()=>J});var i=n(848318),s=n(551316),r=n(719670),o=n(741419),a=n(157907),l=n(514246),h=n(224223),d=n(193324),p=n(141039),c=n(808471),g=n(442313),u=n(697714),f=n(196484),y=n(125395),S=n(557675),E=n(405866),m=n(604613),C=n(453911),k=n(376780),T=n(707717),M=n(503024),I=n(255603),K=n(286720),O=n(387784),b=n(586994),x=n(855584),A=n(988720);function _(t,e){let n=(0,A.TE)(t),i=(0,b.UF)(e)[0].unicode,s=t.getCurrentContent().createEntity("EMOJI","IMMUTABLE",{text:e,unicode:i}).getLastCreatedEntityKey();return L(t,n,s,i,!1)}let L=(t,e,n,i,s)=>{let r=t.getSelection(),o=t.getCurrentContent(),{start:a,end:h}=e,d=r;null!=a&&null!=h&&(d=r.merge({anchorOffset:a,focusOffset:h}));let p=l.Modifier.replaceText(o,d,i,void 0,n),c=p.getSelectionAfter(),g=p.getLastBlock();g.getKey()===c.getStartKey()&&g.getKey()===c.getEndKey()&&g.getLength()===c.getStartOffset()&&g.getLength()===c.getEndOffset()&&(p=l.Modifier.replaceText(p,c,s?"":" ",void 0,void 0));let u=l.EditorState.push(t,p,"insert-fragment");return s?(0,A.aC)(u,"@"):l.EditorState.forceSelection(u,p.getSelectionAfter())};var B=n(814815);let v="editable_typeahead--mention--yPPjQ",w="editable_typeahead--hyperlink--JH0Ig",{hasCommandModifier:F}=l.KeyBindingUtil;var P=(t=>(t.Bold="toggle-bold",t.Italic="toggle-italic",t.Strikethrough="toggle-strikethrough",t))(P||{}),U=(t=>(t.UL="toggle-unordered-list",t.OL="toggle-ordered-list",t))(U||{}),H=(t=>(t.ListBackspace="handle-list-backspace",t.Undo="handle-undo",t.Redo="handle-redo",t.Link="toggle-link",t))(H||{});let R={BOLD:{fontWeight:600},HIGHLIGHT:{background:"var(--color-texthighlight)"}},N={"toggle-bold":"BOLD","toggle-italic":"ITALIC","toggle-strikethrough":"STRIKETHROUGH"},D={"toggle-unordered-list":"unordered-list-item","toggle-ordered-list":"ordered-list-item"},j=new Set(["HIGHLIGHT",...Object.values(N)]);function G(){let t=[{strategy:A.Er,component:t=>i.createElement("span",{className:v,spellCheck:!1},t.children)},{strategy:A.f7,component:t=>i.createElement("span",{className:v,spellCheck:!1},t.children)},{strategy:A.cL,component:t=>i.createElement("span",{className:"editable_typeahead--emoji--vp6nb",spellCheck:!1},t.children)},{strategy:A.mi,component:t=>{let e="",n="";if(t.entityKey&&t.contentState){let i=t.contentState.getEntity(t.entityKey).getData();e=i.hyperlink,n=i.commentEditorType}return i.createElement("span",{className:w,spellCheck:!1,"data-tooltip-type":M.Ib.SPECIAL,"data-tooltip":M.MW.HYPERLINK_POPUP,"data-tooltip-show-above":!0,"data-tooltip-unconstrain-width":!0,"data-tooltip-can-edit":!0,"data-tooltip-url-string":e,"data-tooltip-interactive":!0,"data-tooltip-precise":!0,"data-tooltip-entity-key":t.entityKey,"data-tooltip-target-ref-key":n},t.children)}},{strategy:A.DL,component:t=>{let e=(0,B.V)(t.decoratedText);if(1!==e.length)return i.createElement(i.Fragment,null,t.children);let n=new URL(e[0].href).toString();return i.createElement("span",{className:w,spellCheck:!1,"data-tooltip-type":M.Ib.SPECIAL,"data-tooltip":M.MW.HYPERLINK_POPUP,"data-tooltip-show-above":!0,"data-tooltip-unconstrain-width":!0,"data-tooltip-can-edit":!1,"data-tooltip-url-string":n,"data-tooltip-interactive":!0,"data-tooltip-precise":!0,"data-testid":`implicit-hyperlink-${n}`},t.children)}}];return new l.CompositeDecorator(t)}class W{constructor(){this._isCanceled=!1,this._isEnabled=!0}isCanceled(){return!!this._isEnabled&&this._isCanceled}reset(){this._isEnabled=!1}cancel(){this._isEnabled&&(this._isCanceled=!0)}}class Q extends Error{}async function $(t,e){let n=await t;if(e.isCanceled())throw e.reset(),new Q;return e.reset(),n}let Y=RegExp(/^https?:\/\/(www\.)?[-a-zA-Z0-9@:%._\+~#=]{1,256}\.[a-zA-Z0-9()]{1,6}\b([-a-zA-Z0-9()@:%_\+.~#?&//=]*)$/,"i");class J extends i.Component{constructor(t){super(t),this.TEST_ONLY_mentionsSearchPending=null,this.pendingMentionsSearch=null,this.trackMentionSearchMetrics=(t,e,n)=>{let i=e.index,s=e.mentions?e.mentions.length:0;(0,h.sx)("at_mention_search_metrics",{did_click_through:n,search_text_length:t.length,selected_index:i,suggestions_length:s})},this.onChange=t=>{let e=this.state.editorState;this.setState({editorState:t});let n=e.getCurrentContent(),i=t.getCurrentContent(),s=e.getSelection(),r=t.getSelection();n!==i?this.onEditorContentChange(t):s!==r&&this.clearTypeahead("changed_selection")},this.onEditorContentChange=t=>{let e=(0,A.yN)(t);this.props.updateMessage([e,t]);let{search:n,type:i}=(0,A.TE)(t);null!=n?"MENTION"===i?this.onMentionSearchChange(n):"EMOJI"===i?this.onEmojiSearchChange(n):"COMPLETE_EMOJI"===i&&(this.clearTypeahead("completed_emoji_search"),this.insertEmojiFromString(n)):this.clearTypeahead("input_deleted")},this.hasTypeahead=()=>!!this.props.typeahead,this.insertMention=(t,e)=>{let n=(0,A.Gm)(this.state.editorState);this.state.contactsAnalytics?.trackResultClicked(n,e.index,e.mentions.length,t.id.startsWith("invite-")),this.trackMentionSearchMetrics(n,e,!0);let i=function(t,e){let n=t.getCurrentContent();if(e.id.startsWith("invite-")&&!("profile_handle"in e)){let i=n.createEntity("INVITE","IMMUTABLE",{mention:e}).getLastCreatedEntityKey(),s=(0,A.TE)(t);return L(t,s,i,(0,x.F)(e.handle)||"",!1)}let i=n.createEntity("MENTION","IMMUTABLE",{mention:e}).getLastCreatedEntityKey(),s=(0,A.TE)(t),r="profile_handle"in e?`@${e.profile_handle}`:e.handle;return L(t,s,i,(0,x.F)(r)||"",!1)}(this.state.editorState,t);"profile_handle"in t&&this.props.dispatch((0,y.Hx)(t)),this.onChange(i)},this.insertEmoji=t=>{let e=function(t,e){let n=O.il.getDefaultSkin(),i=n?`:skin-tone-${n}:`:"";return e.skins.length<2&&(i=""),_(t,`:${e.id}:`+i)}(this.state.editorState,t);this.onChange(e)},this.insertSuggestion=t=>{let e=function(t,e){let n=t.getCurrentContent().createEntity("SUGGESTION","IMMUTABLE",{suggestion:e}).getLastCreatedEntityKey(),i=(0,A.TE)(t);return L(t,i,n,e.suggestionInsert,e.suggestionInsert.includes("@"))}(this.state.editorState,t.suggestedComments[t.index]);this.onChange(e)},this.insertFirstPendingUserInvite=t=>{if(t[0].user?.email){let e=function(t,e){let n=t.getCurrentContent().createEntity("INVITE","IMMUTABLE",{mention:{email:e.user.email,id:`invite-${e.id}`}}).getLastCreatedEntityKey(),i=(0,A.TE)(t);return e.user.email?L(t,i,n,e.user.email,!1):t}(this.state.editorState,t[0]);this.onChange(e)}},this.insertEmojiFromString=t=>{let e=_(this.state.editorState,t);this.onChange(e)},this.onInsert=()=>{let t=this.props.typeahead;t&&"mentions"===t.type&&t.mentions[t.index]?this.insertMention(t.mentions[t.index],t):t&&"emojis"===t.type&&t.emojis[t.index]?this.insertEmoji(t.emojis[t.index]):t&&"suggestions"===t.type&&this.insertSuggestion(t)},this.assignEditorOnInsertClear=()=>{this.props.editorOnInsert(this.onInsert),this.props.editorOnClear(()=>this.clearTypeahead("editor_clear"))},this.newMentionsSearch=async t=>{this.pendingMentionsSearch&&this.pendingMentionsSearch.cancel(),this.pendingMentionsSearch=new W;try{return{result:await $((0,T.fG)(t,this.props.mentionables,!this.props.isProtoView&&this.props.figmaEditorType===k._Y.DESIGN),this.pendingMentionsSearch),canceled:!1}}catch(t){if(t instanceof Q)return{result:null,canceled:!0};throw t}},this.onMentionSearchChange=(0,s.s)(async t=>{let e=this.newMentionsSearch(t);(0,c.Lg)()&&(this.TEST_ONLY_mentionsSearchPending=e);let{result:n,canceled:i}=await e;i||(n?(this.state.contactsAnalytics?.trackQueryResult(t,n?.mentions.length??0),this.props.dispatch(f.We(n))):this.props.dispatch(f.We({type:"mentions",mentions:[],index:0,maxMentions:0,search:t})),this.props.onUpdateTextArea(this.state.editorState))},300),this.onEmojiSearchChange=t=>{this.props.dispatch(f.We((0,T.oQ)(t))),this.props.onUpdateTextArea(this.state.editorState)},this.clearTypeahead=t=>{this.pendingMentionsSearch&&this.pendingMentionsSearch.cancel(),this.state.contactsAnalytics?.endSession(t),this.hasTypeahead()&&(this.props.typeahead?.type==="suggestions"?"editor_clear"===t?this.props.dispatch(f.UU({force:!0})):"changed_selection"!==t&&this.props.dispatch(f.We(null)):this.props.dispatch(f.We(null)))},this._handleBeforeInput=(t,e)=>{if(this.props.maxCommentLength&&e.getCurrentContent().getPlainText("").length>=this.props.maxCommentLength)return"handled";let n=(0,A.Wt)(e,t);if("ordered-list-item"===n||"unordered-list-item"===n)return e=(0,A.q7)(e,n),this.onChange(e),"handled";let i=(0,A.XM)(e,t);return i?(e=(0,A.oP)(e,t,i),this.onChange(e),"handled"):"not-handled"},this.selectAll=()=>{let t=this.state.editorState.getSelection(),e=this.state.editorState.getCurrentContent(),n=t.merge({anchorKey:e.getFirstBlock().getKey(),anchorOffset:0,focusOffset:e.getLastBlock().getText().length,focusKey:e.getLastBlock().getKey()});this.setState({editorState:l.EditorState.forceSelection(this.state.editorState,n)})},this.hasFocus=()=>this.state.editorState.getSelection().getHasFocus(),this.focus=(t=!0)=>{let e=this.state.editorState.getSelection();e.getHasFocus()?this.props.onFocus():t?setTimeout(()=>{this.props.moveFocusToStartOnMount?this.setState({editorState:(0,A.jM)(this.state.editorState)}):this.setState({editorState:l.EditorState.moveFocusToEnd(this.state.editorState)}),this.onFocus()},0):this.setState({editorState:l.EditorState.forceSelection(this.state.editorState,e)})},this.moveFocusBefore=()=>{let t=(0,A.d8)(this.state.editorState),e=this.state.editorState.getCurrentContent().getBlockBefore(t.getKey()),n=this.state.editorState.getSelection();if(e){let t=n.merge({anchorKey:e.getKey(),anchorOffset:e.getLength(),focusKey:e.getKey(),focusOffset:e.getLength()});this.setState({editorState:l.EditorState.forceSelection(this.state.editorState,t)})}},this.isAllSelected=()=>{let t=this.state.editorState;return t.isSelectionAtStartOfContent()&&t.isSelectionAtEndOfContent()},this.onNavigationKeyDown=t=>(t.stopPropagation(),this.hasTypeahead())?(t.preventDefault(),null):(0,l.getDefaultKeyBinding)(t),this.handleEscape=()=>{this.hasTypeahead()||this.props.dropdownShown&&this.props.dropdownShown.type===m.VJ||this.props.editingComment&&"comment-editor-reply"===this.props.editorType||this.props.onCancel()},this.handleReturn=(t,e)=>{t.stopPropagation();let n=this.state.editorState.getCurrentContent().getPlainText(),i=/^\s+$/,s=!!n&&!i.test(n),r=e.getSelection(),o=e.getCurrentContent().getBlockForKey(r.getStartKey());if(this.hasTypeahead())return t.preventDefault(),"handled";if(this.props.blockKeyToType&&Object.values(this.props.blockKeyToType).includes(o.getType())){let t=l.Modifier.splitBlock(e.getCurrentContent(),e.getSelection()),n=(e=l.EditorState.push(e,t,"split-block")).getCurrentContent().getBlockAfter(o.getKey());return t=l.Modifier.setBlockType(t,r.merge({anchorKey:n?.getKey(),anchorOffset:0,focusKey:n?.getKey(),focusOffset:0}),"unstyled"),e=l.EditorState.set(e,{allowUndo:!1}),e=l.EditorState.push(e,t,"change-block-type"),e=l.EditorState.set(e,{allowUndo:!0}),this.onChange(e),"handled"}if(s){if(t.altKey||t.metaKey)return t.preventDefault(),this.props.onSubmit(),"handled";if(t.shiftKey||t.ctrlKey){let t=(0,A.XM)(e,"\n");if(t){e=(0,A.oP)(e,"",t);let n=l.Modifier.splitBlock(e.getCurrentContent(),e.getSelection());return e=l.EditorState.push(e,n,"split-block"),this.onChange(e),"handled"}}else if(r.isCollapsed()&&["unordered-list-item","ordered-list-item"].includes(o.getType())){if(i.test(o.getText())){let t=l.Modifier.setBlockType(e.getCurrentContent(),r,"unstyled");e=l.EditorState.push(e,t,"change-block-type")}else{let t=l.Modifier.splitBlock(e.getCurrentContent(),r);e=l.EditorState.push(e,t,"split-block")}return this.onChange(e),"handled"}else if(this.props.submitOnEnter)return t.preventDefault(),this.props.onSubmit(),"handled"}return"not-handled"},this.handlePastedFiles=t=>(this.props.onFilePaste&&this.props.onFilePaste(t),"handled"),this.handlePastedText=(t,e,n)=>{if(!t)return"handled";let i=n.getSelection(),s=n.getCurrentContent();if(!(0,A.c9)(n)&&t.match(Y)&&(0,B.$)((0,I.xT)(t))){for(let t of(i.getIsBackward()&&(i=i.merge({anchorKey:i.getFocusKey(),anchorOffset:i.getFocusOffset(),focusKey:i.getAnchorKey(),focusOffset:i.getAnchorOffset(),isBackward:!1})),Object.values(N)))s=l.Modifier.removeInlineStyle(s,i,t);let e=(s=s.createEntity("HYPERLINK","MUTABLE",{hyperlink:t,commentEditorType:this.props.editorType})).getLastCreatedEntityKey(),r=l.Modifier.applyEntity(s,i,e);n=l.EditorState.push(n,r,"apply-entity");let o=i.merge({anchorOffset:i.getEndOffset(),anchorKey:i.getEndKey(),focusOffset:i.getEndOffset(),focusKey:i.getEndKey()});return n=l.EditorState.forceSelection(n,o),this.onChange(n),"handled"}if((0,a.k)().comments_html_paste&&e){let t=(0,A._S)(e),i=l.Modifier.replaceWithFragment(n.getCurrentContent(),n.getSelection(),t.getBlockMap()),s=l.EditorState.push(n,i,"insert-fragment");return this.onChange(s),"handled"}{let e=l.Modifier.replaceWithFragment(n.getCurrentContent(),n.getSelection(),l.ContentState.createFromText(t).getBlockMap()),i=l.EditorState.push(n,e,"insert-fragment");return this.onChange(i),"handled"}},this.onSubmitHyperlink=t=>{let e=this.state.editorState;if(this.state.hyperlinkState){let n=this.state.hyperlinkState.selectionToHyperlink,i=(0,I.xT)(t);if((0,B.$)(i)){if(n.isCollapsed()){let t=e.getCurrentContent();t=l.Modifier.insertText(t,n,i),e=l.EditorState.push(e,t,"insert-characters");let s=n.getStartOffset();n=(0,A.Ji)(e,{start:s,end:s+i.length})}let t=e.getCurrentContent();for(let e of j)t=l.Modifier.removeInlineStyle(t,n,e);if(e=l.EditorState.push(e,t,"change-inline-style"),this.state.hyperlinkState.entityKey){t=t.replaceEntityData(this.state.hyperlinkState.entityKey,{hyperlink:i,commentEditorType:this.props.editorType});let s=l.Modifier.applyEntity(t,n,this.state.hyperlinkState.entityKey);e=l.EditorState.push(e,s,"apply-entity")}else{let s=(t=t.createEntity("HYPERLINK","MUTABLE",{hyperlink:i,commentEditorType:this.props.editorType})).getLastCreatedEntityKey(),r=l.Modifier.applyEntity(t,n,s);e=l.EditorState.push(e,r,"apply-entity")}}else{let t=e.getCurrentContent();t=l.Modifier.removeInlineStyle(t,n,"HIGHLIGHT"),e=l.EditorState.push(e,t,"change-inline-style"),this.props.dispatch(u.F.enqueue({message:(0,g.t)("hyperlink.invalid_link_plain")}))}this.onChange(e),this.setState({hyperlinkState:null})}},this.onFocus=()=>{if(this.assignEditorOnInsertClear(),this.props.setIsEditorFocused(!0),this.focus(!this.props.maintainSelectionOnFocus),this.state.hyperlinkState?.selectionToHyperlink&&!this.props.hyperlinkLocation){let t=this.state.editorState.getCurrentContent(),e=this.state.editorState;t=l.Modifier.removeInlineStyle(t,this.state.hyperlinkState.selectionToHyperlink,"HIGHLIGHT"),e=l.EditorState.push(e,t,"change-inline-style"),this.onChange(e),this.setState({hyperlinkState:null})}},this.onBlur=()=>{let{typeahead:t}=this.props;if(t&&"mentions"===t.type&&t.mentions[t.index]){this.state.contactsAnalytics?.endSession("input_blurred");let e=(0,A.Gm)(this.state.editorState);this.trackMentionSearchMetrics(e,t,!1)}this.props.setIsEditorFocused(!1)},this.handleKeyCommand=(t,e)=>{if(N[t]){let n=N[t],i=l.RichUtils.toggleInlineStyle(e,n);if(i)return this.onChange(i),"handled"}else if(D[t]){let n=D[t],i=l.RichUtils.toggleBlockType(e,n);if(i)return this.onChange(i),"handled"}else if("handle-undo"===t){e=l.EditorState.undo(e);let t=(0,A.d8)(e).getText();for(let n of A.Bm)if(t.trim()===n||"1."===t.trim()){let n=t.length;e=l.EditorState.forceSelection(e,(0,A.Ji)(e,{start:n,end:n}))}return this.onChange(e),"handled"}else if("handle-redo"===t){let t=(0,A.d8)(e).getText();e=l.EditorState.redo(e);let n=(0,A.d8)(e).getText();for(let i of A.Bm)if(t.trim()===i||n.trim()===i){let t=n.length;return e=l.EditorState.forceSelection(e,(0,A.Ji)(e,{start:t,end:t})),this.onChange(e),"handled"}if("1."===t.trim()||"1."===n.trim()){let t=n.length;return e=l.EditorState.forceSelection(e,(0,A.Ji)(e,{start:t,end:t})),this.onChange(e),"handled"}return this.onChange(e),"handled"}else if("handle-list-backspace"===t){let t=l.Modifier.setBlockType(e.getCurrentContent(),e.getSelection(),"unstyled"),n=l.EditorState.push(e,t,"change-block-type");return this.onChange(n),"handled"}else if("toggle-link"===t){let{selection:t,entityKey:n}=(0,A.M1)(e);e=l.EditorState.forceSelection(e,t),this.onChange(e);let i=(0,A.L5)();if(i&&this.props.setHyperlinkLocation&&this.props.setHyperlinkEditorRef)return this.setHyperlinkEditorState(e,i,n),"handled"}return"not-handled"},this.getActiveHyperlinkForCurrentSelection=()=>this.state.hyperlinkState?.entityKey?this.state.editorState.getCurrentContent().getEntity(this.state.hyperlinkState.entityKey).getData().hyperlink:"",this.onRemoveHyperlink=()=>{if(this.state.hyperlinkState?.entityKey){let t=this.state.editorState,e=l.Modifier.applyEntity(this.state.editorState.getCurrentContent(),this.state.hyperlinkState.selectionToHyperlink,null);this.onChange(l.EditorState.push(t,e,"apply-entity"))}},this.keyBindingFn=t=>{if("Escape"===t.key&&!this.props.delegateEscapeHandling)return this.handleEscape(),null;if("Backspace"===t.key){let t=(0,A.d8)(this.state.editorState);if(("ordered-list-item"===t.getType()||"unordered-list-item"===t.getType())&&(0,A.wT)(this.state.editorState))return"handle-list-backspace"}if("ArrowUp"===t.key||"ArrowDown"===t.key||"ArrowLeft"===t.key||"ArrowRight"===t.key||"Tab"===t.key)return this.onNavigationKeyDown(t);if(F(t)){t.stopPropagation();let e=o.Ez5?.uiState().isUI3.getCopy()??!1,n="k"===t.key&&!e||t.shiftKey&&"u"===t.key&&e;if("z"===t.key&&!t.shiftKey)return"handle-undo";if("z"===t.key&&t.shiftKey)return"handle-redo";if("b"===t.key)return"toggle-bold";if("i"===t.key)return"toggle-italic";if(n)return"toggle-link";if(t.shiftKey&&"x"===t.key)return"toggle-strikethrough";if(t.shiftKey&&"8"===t.key)return"toggle-unordered-list";if(t.shiftKey&&"7"===t.key)return"toggle-ordered-list"}return t.stopPropagation(),(0,l.getDefaultKeyBinding)(t)},this.onMouseDown=t=>{t.stopPropagation()},this.onContextMenu=t=>{p.eD||t.stopPropagation()};let e=(0,C.Ty)(t.currentOrgId??null,t.user??null,t.currentOrgUsers),n=(0,C.pP)(t.currentOrgId,t.openFileTeamId,e),i=t.openFileTeamId??null,r=null,d=G();r=this.props.messageMeta?(0,A.Aw)(this.props.messageMeta,d,this.props.editorType,this.props.existingPendingMentions):l.EditorState.createEmpty(d),this.state={editorState:r,contactsAnalytics:new C.yO(C.I2,t.openFileKey,n,t.currentOrgId,i),hyperlinkState:null}}async componentDidMount(){if(this.assignEditorOnInsertClear(),this.props.mountInputFocused){let t=this.props.moveFocusToStartOnMount?(0,A.jM)(this.state.editorState):l.EditorState.moveFocusToEnd(this.state.editorState);if(this.props.setIsEditorFocused(!0),this.onChange(t),(!this.props.hasMentionedPendingUserInvite||!this.props.hasMentionedPendingUserInviteTwice)&&this.props.pendingUserInvites&&this.props.pendingUserInvites.length>0){if(1===this.props.pendingUserInvites.length)this.insertFirstPendingUserInvite(this.props.pendingUserInvites);else{let{result:e,canceled:n}=await this.newMentionsSearch("");n||setTimeout(()=>{this.props.dispatch(f.We(e)),this.onChange(t),this.props.onUpdateTextArea(this.state.editorState)},180)}}}this.props.editorRef&&this.props.editorType&&this.props.dispatch(S.pP({targetKey:this.props.editorType,targetRef:this.props.editorRef})),this.props.updateMessageOnMount&&this.onEditorContentChange(this.state.editorState)}componentDidCatch(t){"Node.removeChild: The node to be removed is not a child of this node"===t.message&&this.forceUpdate()}componentDidUpdate(t){let e=this.state.editorState;if(!(0,d.Wf)(this.props.messageMeta,t.messageMeta)||this.props.existingPendingMentions!==t.existingPendingMentions){let n=(0,A.yN)(this.state.editorState);if(!(0,d.Wf)(n,this.props.messageMeta)||this.props.existingPendingMentions!==t.existingPendingMentions){let t=G();e=(0,A.Aw)(this.props.messageMeta,t,this.props.editorType,this.props.existingPendingMentions),e=this.state.editorState.getSelection().getHasFocus()?l.EditorState.moveFocusToEnd(e):l.EditorState.moveSelectionToEnd(e),this.onChange(e)}let i=this.props.pendingUserInvites?.length===1?e.getCurrentContent().getPlainText()===`${this.props.pendingUserInvites[0].user?.email} `:""===e.getCurrentContent().getPlainText();(!this.props.hasMentionedPendingUserInvite||!this.props.hasMentionedPendingUserInviteTwice)&&(this.props.pendingUserInvites?.length??0)>0&&this.props.user?.id&&!this.props.typeahead&&i&&setTimeout(async()=>{if(this.props.onUpdateTextArea(this.state.editorState),this.props.pendingUserInvites?.length===1)this.props.dispatch(f.We((0,K.tI)({index:-1,userId:this.props?.user?.id})));else{let t=await (0,T.fG)("",this.props.mentionables,!this.props.isProtoView&&this.props.figmaEditorType===k._Y.DESIGN);this.props.dispatch(f.We(t))}},180)}if(t.mentionables!==this.props.mentionables&&this.onEditorContentChange(e),this.props.initMention&&!t.initMention){let t;let n=e;t=n.getSelection().size>0?l.Modifier.replaceText(n.getCurrentContent(),n.getSelection(),"@"):l.Modifier.insertText(n.getCurrentContent(),n.getSelection(),"@"),this.setState({editorState:l.EditorState.push(e,t,"insert-fragment")})}if(this.props.blockKeyToType&&(!(0,d.Wf)(this.props.messageMeta,t.messageMeta)||!(0,r.c2)(this.props.blockKeyToType,t.blockKeyToType))){let t=e.getSelection(),n=e.getCurrentContent().getBlockMap();for(let t of e.getCurrentContent().getBlocksAsArray()){let e=t.merge({type:this.props.blockKeyToType[t.getKey()]||t.getType(),data:t.getData()});n=n.set(t.getKey(),e)}let i=e.getCurrentContent().merge({blockMap:n,selectionAfter:t});e=l.EditorState.set(e,{allowUndo:!1}),e=l.EditorState.push(e,i,"change-block-type"),e=l.EditorState.set(e,{allowUndo:!0}),this.onChange(e)}if(!t.typeahead&&this.props.typeahead&&"mentions"===this.props.typeahead.type){let{search:t}=(0,A.TE)(e);""===t&&this.state.contactsAnalytics?.trackQueryResult("",this.props.typeahead.mentions.length),this.props.dispatch(f.Qe())}}componentWillUnmount(){this.props.setIsEditorFocused(!1);let t=this.props.pendingUserInvites&&this.props.pendingUserInvites.length>0;t&&!this.props.hasMentionedPendingUserInvite?(this.props.dispatch(E.b({has_mentioned_pending_user_invite:!0})),this.props.setPendingUserInvitesAtom?.([])):t&&this.props.hasMentionedPendingUserInvite&&!this.props.hasMentionedPendingUserInviteTwice&&this.props.dispatch(E.b({has_mentioned_pending_user_invite_twice:!0}))}editHyperlinkFromTooltip(t,e){let n=this.state.editorState.getCurrentContent(),i="",s=0,r=0;if(n.getBlockMap().every((e,n)=>(e&&e.findEntityRanges(e=>e.getEntity()===t,(t,e)=>{i=n||"",s=t,r=e}),!i)),this.props.dispatch(S.jD()),""===i)return;let o=this.state.editorState.getSelection().merge({anchorKey:i,focusKey:i,anchorOffset:s,focusOffset:r});o=(0,A.Qo)(this.state.editorState,o,t);let a=l.EditorState.forceSelection(this.state.editorState,o);this.onChange(a),e&&this.setHyperlinkEditorState(a,e,t)}setHyperlinkEditorState(t,e,n){if(this.props.setHyperlinkLocation&&this.props.setHyperlinkEditorRef&&this.props.editorRef){this.setState({hyperlinkState:{selectionToHyperlink:t.getSelection(),entityKey:n}}),this.props.setHyperlinkLocation(e),this.props.setHyperlinkEditorRef(this.props.editorRef);let i=l.Modifier.applyInlineStyle(t.getCurrentContent(),t.getSelection(),"HIGHLIGHT"),s=l.EditorState.push(t,i,"change-inline-style");this.onChange(s)}}render(){let t="editable_typeahead--wrapperBase--rwdvD";t=this.props.className?t+" "+this.props.className:t+" editable_typeahead--wrapperDefault--G1MoY";let e=(0,A.FA)(this.state.editorState);return i.createElement("div",{className:t,onMouseDown:this.onMouseDown,onContextMenu:this.onContextMenu,onFocus:this.onFocus,onClick:this.onFocus,"data-testid":"editable-typeahead"},i.createElement(l.Editor,{editorState:this.state.editorState,placeholder:e?this.props.placeholderText:void 0,onChange:this.onChange,handleReturn:this.handleReturn,keyBindingFn:this.keyBindingFn,handleKeyCommand:this.handleKeyCommand,spellCheck:!0,onBlur:this.onBlur,handleBeforeInput:this._handleBeforeInput,tabIndex:this.props.tabIndex||0,handlePastedText:this.handlePastedText,handlePastedFiles:this.handlePastedFiles,customStyleMap:R,readOnly:this.props.readOnly,blockStyleFn:this.props.blockStyleFn,ariaLabel:this.props.ariaLabel}))}}J.displayName="EditableTypeahead"},988720:(t,e,n)=>{n.d(e,{Aw:()=>Y,Bm:()=>E,DL:()=>k,Er:()=>T,FA:()=>w,Gm:()=>K,Ji:()=>U,L5:()=>A,M1:()=>_,Qo:()=>B,TE:()=>b,Wt:()=>j,XM:()=>D,_S:()=>X,aC:()=>O,c9:()=>v,cL:()=>m,d8:()=>P,f7:()=>M,jM:()=>V,mi:()=>C,oP:()=>G,q7:()=>W,wT:()=>F,yN:()=>Q});var i=n(514246),s=n(426804),r=n.n(s),o=n(322035),a=n(193324),l=n(586994),h=n(855584),d=n(431118),p=n(255603),c=n(814815);let g={BOLD:"b",ITALIC:"i",STRIKETHROUGH:"s"},u={b:"BOLD",i:"ITALIC",s:"STRIKETHROUGH"},f={BOLD:[{char:"*",sequence:"**"},{char:"_",sequence:"__"}],ITALIC:[{char:"*",sequence:"*"},{char:"_",sequence:"_"}],STRIKETHROUGH:[{char:"~",sequence:"~"}]},y=/:([0-9A-Za-z-_+]+)$/,S=/(:[0-9A-Za-z-_+]+:)$/,E=new Set(["*","-","+"]);function m(t,e,n){return I(t,e,n,"EMOJI")}function C(t,e,n){return I(t,e,n,"HYPERLINK")}function k(t,e){let n=t.getText();for(let i of(0,c.V)(n).filter(e=>{for(let n=e.start;n<e.end;n++)if(t.getEntityAt(n))return!1;return!0}))e(i.start,i.end)}function T(t,e,n){return I(t,e,n,"MENTION")}function M(t,e,n){return I(t,e,n,"INVITE")}let I=(t,e,n,i)=>{t.findEntityRanges(t=>(function(t,e,n){return null!==e&&t.getEntity(e).getType()===n})(n,t.getEntity(),i),e)};function K(t){let e=t.getSelection(),n=t.getCurrentContent(),i=e.getAnchorKey(),s=n.getBlockForKey(i),r=e.getAnchorOffset(),o=x(s.getText().substring(0,r));return null!==o?o.search:""}function O(t,e){let n=t.getCurrentContent().getBlockMap().toArray(),s=null;for(let t of n){let n=t.getText().indexOf(e);if(-1!==n){s={blockKey:t.getKey(),position:n+1};break}}if(s){let e=new i.SelectionState({anchorKey:s.blockKey,anchorOffset:s.position,focusKey:s.blockKey,focusOffset:s.position});return i.EditorState.forceSelection(t,e)}return t}function b(t){let e,n,i,s;let r=t.getSelection(),o=t.getCurrentContent(),d=r.getAnchorKey(),p=o.getBlockForKey(d),c=r.getAnchorOffset(),g=o.getBlocksAsArray(),u=Q(t),f=p.getText().substring(0,c),E=f.match(y),m=f.match(S),C=x(f);if(C){let t=function(t,e,n,i,s){let{token:r}=function t(e,n){let i=0;for(let s=0;s<n.length;s++){if(n[s].children?.length){let{lengthOfText:r,token:o}=t(e-i,n[s].children);if((i+=r)>e)return{lengthOfText:i,token:o}}else n[s].t?i+=n[s].t?.replace(/\n/g,"").length||0:i+=h.F(n[s].user_annotated?.handle)?.length||0;if((i+="profile_id"in n[s]?1:0)>e)return{lengthOfText:i,token:n[s]}}return{lengthOfText:i,token:null}}(function(t,e,n,i){let s=0;for(let n=0;n<t.length&&t[n]!==e;++n)s+=t[n].getText().replace(/\n/g,"").length;return s+(n-(i.match(/\n/g)||[]).length)}(t,e,n,s),i);return r}(g,p,C.index,u,f);C=t&&(0,a.l5)(t)===a.vj.PLAIN_TEXT?C:null}return C?(e="MENTION",n=C.search,i=C.index,s=c):E?(e="EMOJI",n=E[1],i=E.index,s=c):m&&(0,l.xM)(m[1])&&(e="COMPLETE_EMOJI",n=m[1],i=m.index,s=c),{type:e,search:n,start:i,end:s}}function x(t){let e;let n=0,i=0;-1!==t.lastIndexOf("\n")&&(i=t.lastIndexOf("\n")+1,t=t.substring(i));let s=t.lastIndexOf("@");if(-1!==s){if(e=t.substring(s+1),n=s," "===e.substring(0,1)||e.length>100)return null;let i=t.substring(0,s),r=i.lastIndexOf("@");if(-1!==r){let s=t.substring(r+1);if(-1===s.indexOf(" ")){if(0!==r&&" "!==i[r-1])return null;e=s,n=r}}else if(0!==s&&![" ","[","{","("].includes(t[s-1]))return null}return null!=e?{search:e,index:n+=i}:null}function A(){let t=window.getSelection();if(t&&t.rangeCount>0){let e=t.getRangeAt(0).getBoundingClientRect();return(0,o.E)(e)}return null}function _(t){var e;let n=t.getSelection(),i=null;if((e=n).getStartKey()===e.getEndKey()){let e=P(t),s=[];if(e.findEntityRanges(e=>{let n=e.getEntity();return null!==n&&"HYPERLINK"===t.getCurrentContent().getEntity(n).getType()},(t,e)=>{s.push({start:t,end:e})}),s.length<1)return{selection:n,entityKey:i};let r={start:n.getStartOffset(),end:n.getEndOffset()};for(let o of s)if(r.start>=o.start&&r.end<=o.end){n=U(t,o),i=e.getEntityAt(o.start);break}}return i&&(n=B(t,n,i)),{selection:n,entityKey:i}}function L(t,e,n,i){let s=e.getEntityAt(n);if(!s)return!1;let r=t.getEntity(s);return"HYPERLINK"===r.getType()&&r.getData().hyperlink===i}function B(t,e,n){let i=t.getCurrentContent(),s=i.getEntity(n);if(!s||"HYPERLINK"!==s.getType())return e;let r=s.getData().hyperlink,o=i.getBlockForKey(e.getStartKey()),a=e.getStartOffset(),l=o,h=a-1;t:for(let t=0;t<i.getBlocksAsArray().length&&l;t++){for(;h>=0;h--){if(!L(i,l,h,r))break t;o=l,a=h}l=i.getBlockBefore(l.getKey()),h=(l?.getLength()||0)-1}let d=i.getBlockForKey(e.getEndKey()),p=e.getEndOffset();l=d,h=p+1;t:for(let t=0;t<i.getBlocksAsArray().length&&l;t++){for(;h<=l.getLength();h++){if(!L(i,l,h-1,r))break t;d=l,p=h}l=i.getBlockAfter(l.getKey()),h=1}return e.merge({anchorOffset:a,anchorKey:o.getKey(),focusOffset:p,focusKey:d.getKey()})}function v(t){let e=t.getSelection();return e.getAnchorKey()===e.getFocusKey()&&e.getAnchorOffset()===e.getFocusOffset()}function w(t){let e=t.getCurrentContent();return!e.hasText()&&"unstyled"===e.getBlockMap().first().getType()}function F(t){return!!v(t)&&0===t.getSelection().getStartOffset()}function P(t){let e=t.getSelection().getAnchorKey();return t.getCurrentContent().getBlockForKey(e)}function U(t,e){let n=P(t);return i.SelectionState.createEmpty(n.getKey()).merge({anchorOffset:e.start,focusOffset:e.end})}function H(t,e,n){let s=U(t,e);return i.Modifier.replaceText(t.getCurrentContent(),s,n)}let R=t=>{let{index:e,char:n,line:i,numRepeats:s,exactMatch:r}=t;if(r&&e-s-1>=0&&i.charAt(e-s-1)===n)return!1;for(let t=0;t<s;t++)if(i.charAt(e-t-1)!==n)return!1;return!0},N=(t,e,n)=>{if(n-1>0&&" "===t.charAt(n-1))return null;for(let i=n-1;i>=0;i--){if(" "===t.charAt(i))continue;let s=!1;switch(e){case"BOLD":for(let{char:e,sequence:r}of f.BOLD)t.charAt(i)!==e&&t.charAt(n)===e&&R({index:i,char:e,line:t,numRepeats:r.length,exactMatch:!1})&&(s=!0);break;case"ITALIC":for(let{char:e,sequence:r}of f.ITALIC)if(t.charAt(i)!==e&&t.charAt(n)===e&&R({index:i,char:e,line:t,numRepeats:r.length,exactMatch:!1})){if("_"===e){let e=i-r.length-1;(e<0||" "===t.charAt(e))&&(s=!0)}else s=!0}break;case"STRIKETHROUGH":for(let{char:e,sequence:r}of f.STRIKETHROUGH)t.charAt(i)!==e&&t.charAt(n)===e&&R({index:i,char:e,line:t,numRepeats:r.length,exactMatch:!1})&&(s=!0)}if(s)return{start:i,end:n}}return null};function D(t,e){if(!v(t))return null;let n=t.getSelection(),i=P(t),s=n.getAnchorOffset();if(0===s&&""===e){let e=t.getCurrentContent().getBlockBefore(i.getKey());if(!e)return null;i=e,s=e.getLength()}let r=i.getText();for(let t of Object.keys(f))for(let n of f[t]){let{char:i,sequence:o}=n;if(e!==i&&R({index:s,char:i,line:r,numRepeats:o.length,exactMatch:!0})){let e=N(r,t,s-o.length);if(e)return{sequence:o,style:t,range:e}}}return null}function j(t,e){if(" "!==e||!v(t))return null;let n=t.getSelection(),i=P(t);if(" "===e){let t=r()(i.getText().slice(0,n.getAnchorOffset()));if(E.has(t))return"unordered-list-item";if("1."===t)return"ordered-list-item"}return null}function G(t,e,n){let{sequence:s,style:r,range:o}=n;if(e.length){let n=i.Modifier.insertText(t.getCurrentContent(),U(t,{start:o.end+s.length,end:o.end+s.length}),e);t=i.EditorState.push(t,n,"insert-characters")}let a=i.Modifier.removeRange(t.getCurrentContent(),U(t,{start:o.end,end:o.end+s.length}),"backward");a=i.Modifier.removeRange(a,U(t,{start:o.start-s.length,end:o.start}),"backward");let l={start:o.start-s.length,end:o.end-s.length},h=U(t,l),d=i.Modifier.applyInlineStyle(a,h,r);t=i.EditorState.push(t,d,"change-inline-style");let p={start:l.end+e.length,end:l.end+e.length};return t=i.EditorState.forceSelection(t,U(t,p))}function W(t,e){let n={start:0,end:t.getSelection().getAnchorOffset()},s=P(t).getText().slice(n.start,n.end),r=H(t,n,`${s} `),o=H(t=i.EditorState.push(t,r,"insert-characters"),{start:n.start,end:n.end+1},""),a={start:0,end:0},l=U(t,a),h=i.Modifier.setBlockType(o,l,e);return t=i.EditorState.push(t,h,"change-block-type"),t=i.EditorState.forceSelection(t,U(t,a))}function Q(t){let e,n;let s=[],r="",o=t=>{let e=n||s;t.profile_id||t.user_id||t.user_annotated||t.styles||t.link?e.push(t):""!==t.t&&(e.length&&"t"in e[e.length-1]&&1===Object.keys(e[e.length-1]).length?e[e.length-1].t+=t.t:e.push(t))},a=(t,e,n)=>{let i=l.entityMap[t.key],s={};"MENTION"===i.type&&"profile_handle"in i.data.mention?(s.profile_id=i.data.mention.id,s.t=i.data.mention.profile_handle):"MENTION"===i.type?(s.user_id=i.data.mention.id,s.user_annotated=i.data.mention):"HYPERLINK"===i.type?(s.link=i.data.hyperlink,s.t=e):"EMOJI"===i.type?s.t=i.data.text:"INVITE"===i.type?(s.t=i.data.mention.email,s.user_id=i.data.mention.id):(s.t=e,n.length&&(s.styles=n)),o(s)},l=(0,i.convertToRaw)(t.getCurrentContent()),p="";return l.blocks.forEach(t=>{let i=(0,d.Qt)((0,h.F)(t.text)||"");["ordered-list-item","unordered-list-item"].includes(t.type)?(t.type!==r&&(n&&s.push({styles:["ordered-list-item"===r?"ol":"ul"],children:e}),e=[],n=[]),e||=[],n||=[],r=t.type.slice()):(s.length&&""===r&&o({t:"\n"}),n&&(s.push({styles:["ordered-list-item"===r?"ol":"ul"],children:e}),e=void 0,n=void 0),r="");let l={};t.entityRanges.forEach(t=>{l[t.offset]=t});let u={};(0,c.V)(t.text).forEach(t=>{let{start:e,end:n}=t;for(let t=e;t<n;t++)if(l[t])return;u[e]=t});let f={};t.inlineStyleRanges.forEach(t=>{t.offset in f?f[t.offset].push(t):f[t.offset]=[t]});let y=[],S={};for(let t=0;t<i.length;t++){if(t in S&&y.length&&(o({t:p,styles:[...y]}),p="",y=y.filter(e=>!S[t].includes(e))),t in l){let e=l[t];if(y.length)for(var E in o({t:p,styles:[...y]}),y=[],S)Number(E)>t+e.length&&y.push(...S[E]);else o({t:p});p="",a(e,i.slice(t,t+e.length).join(""),y),t+=e.length-1;continue}if(t in u){let e=u[t],n=e.end-e.start;if(y.length)for(var E in o({t:p,styles:[...y]}),y=[],S)Number(E)>t+n&&y.push(...S[E]);else o({t:p});p="",o({t:i.slice(t,t+n).join(""),link:e.href}),t+=n-1;continue}t in f&&(y.length?o({t:p,styles:[...y]}):o({t:p}),p="",f[t].forEach(t=>{if(g[t.style]){let e=g[t.style];y.push(e);let n=t.offset+t.length;n in S?S[n].push(e):S[n]=[e]}})),p+=i[t]}y.length?o({t:p,styles:[...y]}):o({t:p}),p="",n&&(0===n.length&&n.push({t:""}),e.push({children:n}),n=[])}),n&&s.push({styles:["ordered-list-item"===r?"ol":"ul"],children:e}),s}let $=(t,e,n,i,s,r="default",o)=>{let a=[],g=[],f="",y=[];t.forEach(t=>{let e=(0,h.F)(t.t);if(e){let n=e.split("\n");1===n.length?y.push(t):n.forEach((e,i)=>{let s=i<n.length-1?`${e}
`:e;void 0!==t.styles?y.push({t:s,styles:t.styles}):y.push({t:s})})}else y.push(t)}),y.forEach(t=>{let y=(0,h.F)(t.t);if(o){for(let t of o)if(y?.includes(t)){let e=y.indexOf(t),n={can_view:!0,email:t,handle:t,id:`invite-${t}`};a.push({key:Object.keys(i).length,length:(0,d.Qt)(t).length,offset:f.length+e}),i[Object.keys(i).length]={type:"INVITE",mutability:"IMMUTABLE",data:{mention:n}}}}if(t.children?.length){""!==f&&(s.push({text:f,entityRanges:a,type:r,depth:0,inlineStyleRanges:g,key:s.length.toString()}),f="",g=[],a=[]);let l=t.styles?.includes("ol")?"ordered-list-item":"unordered-list-item";t.children.forEach(t=>{t.children?.length&&$(t.children,e,n,i,s,l,o)})}else if(t.user_annotated||t.profile_id){let e=t.user_annotated?(0,h.F)(t.user_annotated.handle)||"":"@"+y,n=t.user_annotated?t.user_annotated:{id:t.profile_id,profile_handle:y};a.push({key:Object.keys(i).length,length:(0,d.Qt)(e).length,offset:(0,d.Qt)(f).length}),i[Object.keys(i).length]={type:"MENTION",mutability:"IMMUTABLE",data:{mention:n}},f+=e}else if(t.link&&(0,c.$)((0,p.xT)(t.link)))a.push({key:Object.keys(i).length,length:(0,d.Qt)(y).length,offset:(0,d.Qt)(f).length}),i[Object.keys(i).length]={type:"HYPERLINK",mutability:"MUTABLE",data:{hyperlink:t.link,commentEditorType:n}},f+=y;else{if(t.styles?.length)t.styles.forEach(t=>{if(u[t]){let e=u[t];g.push({style:e,length:(0,d.Qt)(y).length,offset:(0,d.Qt)(f).length})}});else if((0,l.Lg)(y)){let t=(0,l.wd)(y),e=0,n="";for(let s of t){let t="",r="";(0,l.xM)(s)&&((0,l.UF)(s).forEach(e=>{t+=e.unicode,r+=e.meta}),a.push({key:Object.keys(i).length,length:(0,d.Qt)(t).length,offset:(0,d.Qt)(f).length+e}),i[Object.keys(i).length]={type:"EMOJI",mutability:"IMMUTABLE",data:{text:r,unicode:t}}),n+=t.length?t:s,e+=(0,d.Qt)(t.length?t:s).length}y=n}y?.endsWith("\n")?(f+=y.slice(0,-1),s.push({text:f,entityRanges:a,type:r,depth:0,inlineStyleRanges:g,key:s.length.toString()}),f="",a=[],g=[]):f+=y}}),(""!==f||"default"!==r)&&s.push({text:f,entityRanges:a,type:r,depth:0,inlineStyleRanges:g,key:s.length.toString()})};function Y(t,e,n,s){let r={},o=[];$(t,e,n,r,o,"default",s);let a=(0,i.convertFromRaw)({blocks:o,entityMap:r});return i.EditorState.createWithContent(a,e)}let J=t=>{let e=t.getCurrentContent().getFirstBlock(),n=e.getKey(),s=e.getLength();return i.EditorState.acceptSelection(t,new i.SelectionState({anchorKey:n,anchorOffset:s,focusKey:n,focusOffset:s,isBackward:!1}))};function V(t){let e=J(t);return i.EditorState.forceSelection(e,e.getSelection())}let q=t=>{let e=t.getAttribute("data-mention-user-id"),n=t.getAttribute("data-tooltip-user-handle");return e&&n?{id:e,handle:n}:null},z=t=>t.getAttribute("data-tooltip-url-string");function X(t,e){var n=new DOMParser().parseFromString(t,"text/html"),s=n.getElementsByTagName("a");let r={};for(let t=0;t<s.length;t++){s[t].setAttribute("href",new URL(s[t].href,document.baseURI).toString());let e=s[t].getAttribute("href"),n=q(s[t]);n&&e&&(r[e]=n);let i=z(s[t]);i&&s[t].setAttribute("href",i)}n.querySelectorAll('[data-stringify-type="paragraph-break"]').forEach(function(t){let e=n.createElement("br");t.parentNode&&t.parentNode.replaceChild(e,t)});let o=n.querySelector("body"),a=o?o.innerHTML:n.documentElement.outerHTML,l=a.includes("\x3c!--StartFragment--\x3e")?a:a.replace(/(?:\r\n|\r|\n)/g,"<br/>"),h=(0,i.convertFromHTML)(l),d=i.ContentState.createFromBlockArray(h.contentBlocks,h.entityMap);return d.getBlockMap().forEach(t=>{t?.findEntityRanges(t=>{let e=t.getEntity();return!!e&&"LINK"===d.getEntity(e).getType()},(n,s)=>{let o=t.getText().slice(n,s),a=i.SelectionState.createEmpty(t.getKey());a=a.merge({anchorOffset:n,focusKey:t.getKey(),focusOffset:s});let l=t.getEntityAt(n),h=d.getEntity(l).getData().url,g=r[h];g&&g.handle===o?d=d.createEntity("MENTION","IMMUTABLE",{mention:r[h]}):c.$(p.xT(h))&&(d=d.createEntity("HYPERLINK","MUTABLE",{hyperlink:h,editorType:e}));let u=d.getLastCreatedEntityKey();d=i.Modifier.applyEntity(d,a,u)})}),d}}}]);

//# debugId=d61f0649-101d-5997-a346-325986314da9

//# sourceMappingURL=https://admin.figma.com/admin/webpack-artifacts/0aa6af220e3c164a0efd6ef8718616451a2251d5/6436-480fe96c5879c74d.min.js.map