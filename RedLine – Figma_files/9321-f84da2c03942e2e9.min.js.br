"use strict";
!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},n=(new Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="37c36760-a2c1-5a52-a7ac-f197818501a4")}catch(e){}}();
(globalThis.webpackChunk_figma_web_bundler=globalThis.webpackChunk_figma_web_bundler||[]).push([[9321],{611928:(e,t,a)=>{a.d(t,{CQ:()=>r,DA:()=>y,Fd:()=>m,KG:()=>h,RO:()=>p,UD:()=>i,YI:()=>u,_5:()=>I,_f:()=>d,aF:()=>s,ku:()=>E,lt:()=>C,pb:()=>f,q3:()=>b,w8:()=>o,wg:()=>k,xe:()=>n,y3:()=>l,yD:()=>c,zE:()=>g,zb:()=>_});let l="create_feed_post_modal--avatarFloat--iIveN",o="create_feed_post_modal--addBorder--ioWGk",n="create_feed_post_modal--contentContainerV2--QwkuY",r="create_feed_post_modal--buttonRowV3--5nAjk modal--buttonRow--o2A0S",d="create_feed_post_modal--buttonRowLeft--TRB9A",i="create_feed_post_modal--buttonContainer--eO4q8",s="create_feed_post_modal--inputSectionMinimized--bq7wz create_feed_post_modal--inputSection--7p1jN",c="create_feed_post_modal--inputFields--bFFV7",m="create_feed_post_modal--draftText--n3VG5",u="create_feed_post_modal--postLoadingSpinner--rky-A",f="create_feed_post_modal--postButton--kaBoj",_="create_feed_post_modal--postingButton--VH5JE create_feed_post_modal--postButton--kaBoj",p="create_feed_post_modal--modalWrapper--4Bi1n",g="create_feed_post_modal--modalWrapperMinimized--syjBM create_feed_post_modal--modalWrapper--4Bi1n",E="create_feed_post_modal--contentNonEmpty--vTrJ6",C="create_feed_post_modal--contentWrapperMinimizedV2--Y56bB create_feed_post_modal--contentWrapperV2--CuYTA",b="create_feed_post_modal--contentWrapperV3--bCplT create_feed_post_modal--contentWrapperV2--CuYTA",y="create_feed_post_modal--descriptionWrapperV3--KrwNd",h="create_feed_post_modal--avatarAndDescriptionWrapperMinimized--yrvzI create_feed_post_modal--avatarAndDescriptionWrapper--JTvU3",k="create_feed_post_modal--minimizedButtonContainerV2--ZJZV- create_feed_post_modal--minimizedButtonContainer--fxgaf",I="create_feed_post_modal--loadingWrapper--mesOB"},543532:(e,t,a)=>{a.d(t,{v:()=>T,P:()=>O});var l=a(848318),o=a(716544),n=a(741419),r=a(980399);if(443==a.j)var d=a(813321);var i=a(224223),s=a(397579),c=a(427193),m=a(182059),u=a(473889),f=a(771186),_=a(575492),p=a(197945),g=a(166365),E=a(442313),C=a(790355),b=a(789269),y=a(950738),h=a(51910),k=a(369600),I=a(793954),v=a(877297),N=a(205397),w=a(810968);let S="post_to_feed_view--caretIcon--akCZQ";if(443==a.j)var F=a(523860);if(443==a.j)var x=a(862045);if(443==a.j)var M=a(85206);var T=(e=>(e.LOADED="post-to-feed-view-loaded",e.SELECT_NODE="post-to-feed-select-node",e))(T||{});function A(e){return l.createElement("div",{className:null!==e.isSelectedIdx?"post_to_feed_view--selectedTile--D6T9A post_to_feed_view--tile--9a4ta":"post_to_feed_view--tile--9a4ta",onClick:e.onClick,role:"button",tabIndex:0,ref:t=>{t&&e.observe(t)},"data-observer-guid":e.node.guid},l.createElement("div",{className:"post_to_feed_view--tileThumbnail--FkrR9",style:{backgroundColor:e.backgroundColor}},l.createElement(f.x,{isLoading:!e.thumbnailUrl},()=>l.createElement("img",{className:"post_to_feed_view--thumbnail--uAumv",src:e.thumbnailUrl,alt:"",draggable:!1}))),l.createElement("div",{className:"post_to_feed_view--tileDetails--FZrxQ"},l.createElement("div",{className:"post_to_feed_view--nodeName--jbJro"},e.node.name)),null!==e.isSelectedIdx&&1!==e.totalNumSelected&&l.createElement("div",{className:"post_to_feed_view--tileOverlay--iyl2x"},e.isSelectedIdx+1))}function D(e){let{toggleSelectNode:t}=e,a=(e.pageNode&&(0,r.colorToHex)(e.pageNode.backgroundColor))??"",[o,n]=l.useState(!1),d=l.useCallback(l=>{t(l,{pageId:e.pageNode.guid,pageBackgroundColor:a})},[t,e.pageNode.guid,a]);return l.createElement("div",{className:"post_to_feed_view--pageSection--85j7J"},e.showCollapsibleHeader&&l.createElement("div",{className:"post_to_feed_view--pageHeader--ZOfTF",onClick:()=>n(e=>!e),role:"button",tabIndex:0},o?l.createElement(g.B,{svg:M.A,className:S}):l.createElement(g.B,{svg:F.A,className:S}),e.pageNode.name,"\xa0",l.createElement("span",{className:"post_to_feed_view--pageHeaderFaint--p-zwO"},"\xb7 ",e.nodes.length)),!o&&l.createElement("div",{className:"post_to_feed_view--tilesGrid--Ft03l"},e.nodes.map(t=>{let o=e.selectedNodeGuids?.indexOf(t.guid)??null;return l.createElement(A,{key:`node-${t.guid}`,node:t,thumbnailUrl:e.thumbnailByGuid[t.guid]?.url??"",backgroundColor:a,isSelectedIdx:-1===o?null:o,onClick:()=>d(t.guid),totalNumSelected:e.selectedNodeGuids?.length??null,observe:e.observe})})))}let P="feed-post-page-selector-menu";function O(){let e=l.useCallback((e,t)=>{let a=window.parent;window.self.origin===a.origin&&a&&a.postMessage({type:e,data:t})},[]),t=l.useRef(new c.jk("feed_post_to_file_load",{}));l.useEffect(()=>{t.current.start()},[]);let a=(0,h.aV)(),r=(0,h.eY)(),f=(0,k.tS)();l.useEffect(()=>{if(!a){t.current.stop();let a=t.current.getElapsedTime();(0,i.sx)("team_feed.post_from_file.file_load",{elapsedMs:a,fileKey:f}),e("post-to-feed-view-loaded",!0)}},[a,e,f]);let S=(0,o.d4)(e=>e.mirror.appModel.pagesList),F=l.useMemo(()=>S.reduce((e,t)=>({...e,[t.nodeId]:r.get(t.nodeId)}),{}),[S,r]),M=(0,o.wA)(),T=l.useMemo(()=>Object.values(F).flatMap(e=>e?e.uiOrderedChildren.map(t=>{let a=r.get(t);return a&&("FRAME"===a.type||"SECTION"===a.type)?{...a,pageId:e.guid,name:a?.name}:null}).filter(e=>e):[]).filter(e=>null!==e),[F,r]),A=l.useMemo(()=>{let e={};for(let t of T)e[t.pageId]?e[t.pageId].push(t):e[t.pageId]=[t];return e},[T]),O=l.useMemo(()=>new I.Ef(T,{keys:["name"]}),[T]),[B,L]=l.useState(""),[R,K]=l.useState(null),[z]=(0,d.A)(B,200),U=l.useCallback(e=>{K(O.search(e))},[O]),j=l.useMemo(()=>{if(null===R)return null;let e={};for(let t of R)e[t.pageId]?e[t.pageId].push(t):e[t.pageId]=[t];return e},[R]);l.useEffect(()=>{""!==z&&U(z)},[z,U]);let W=(0,y.Um)(),V=l.useRef(null),[G,Q]=l.useState(null);l.useEffect(()=>{if(G||!r||!A||0===Object.keys(A).length)return;let e=r.get(Object.keys(A)[0]);e&&Q(e)},[G,A,r]);let[Z,X]=l.useState({}),[q,Y]=l.useState([]),J=(0,s.ZC)(q),$=l.useRef(null),[H,ee]=l.useState([]),et=l.useCallback(e=>{let t=[];e.forEach(e=>{if(e.isIntersecting&&e.target instanceof HTMLElement){let a=e.target.dataset?.observerGuid;a&&t.push(a)}}),ee(t)},[]),ea=l.useMemo(()=>new IntersectionObserver(et,{threshold:[.25]}),[et]),el=l.useCallback(e=>{ea&&ea.observe(e)},[ea]),[eo,en]=l.useState({});l.useEffect(()=>{if(0===H.length)return;let e=H.filter(e=>!eo[e]);0!==e.length&&(0,b.Jr)().loadAllImagesUnder(e,n.MoD.NON_ANIMATED_ONLY,"feed.postFromFile").then(()=>{e.forEach(e=>{setTimeout(()=>{en(t=>{if(t[e])return t;let a=(0,w.BO)(e);return{...t,[e]:{url:URL.createObjectURL(new Blob([a])),data:a}}})},0)})})},[H,eo]),l.useEffect(()=>{q!==J&&e("post-to-feed-select-node",q.map(e=>({guid:e,thumbnail:eo[e].data,backgroundColor:Z[e]})))},[J,q,e,eo,Z]);let er=l.useCallback((e,t)=>{eo[e]&&(X(a=>t.pageBackgroundColor?{...a,[e]:t.pageBackgroundColor}:a),Y(t=>t.includes(e)?t.filter(t=>e!==t):t.length>=v.e3?t:[...t,e]))},[eo]);return A&&0===Object.keys(A).length?l.createElement("div",{className:"post_to_feed_view--noContentContainer--VE8Tm post_to_feed_view--container--BiDZs text--fontPos16--oMC-G text--_fontBase--QdLsd"},(0,E.t)("fig_feed.no_top_level_nodes")):G?l.createElement("div",{className:"post_to_feed_view--container--BiDZs"},l.createElement("div",{className:"post_to_feed_view--searchFilterContainer--lyX72"},l.createElement(p.IW,{query:B,className:"post_to_feed_view--searchBar--IwmvI",onChange:L,clearSearch:()=>{L(""),K(null)},focusOnMount:!1,iconClassName:"post_to_feed_view--searchIcon---WXsZ",placeholder:(0,E.t)("fig_feed.search_frames")}),""===B&&l.createElement(l.Fragment,null,l.createElement("div",{role:"button",ref:V,onClick:()=>{W?.type===P?M(C.oB()):M(C.j7({type:P}))},tabIndex:0,className:"post_to_feed_view--pageMenuDropdown--bS4RV"},l.createElement("div",null,G.name),l.createElement(g.B,{svg:x.A,width:"8px",autosize:!0})),V.current&&W?.type===P&&l.createElement(N.Cf,{showPoint:!1,targetRect:V.current.getBoundingClientRect(),propagateCloseClick:!0},Object.keys(A).map(e=>l.createElement(m.MM,{key:e,onClick:()=>Q(F[e]),checked:G.guid===e},F[e].name))))),l.createElement(_.P,{hideScrollbar:!0,className:"post_to_feed_view--scrollContainer--syalR",innerClassName:"post_to_feed_view--innerScrollContainer--aP8K2",scrollContainerRef:$},""===B&&l.createElement(D,{pageNode:G,nodes:A[G.guid]||[],thumbnailByGuid:eo,selectedNodeGuids:q,toggleSelectNode:er,observe:el}),""!==B&&(null===j?l.createElement("div",{className:"post_to_feed_view--loadingSpinnerContainer--E8n20"},l.createElement(u.kt,{size:"large"})):Object.entries(j).length>0?Object.entries(j).map(([e,t])=>l.createElement(D,{key:e,pageNode:F[e],nodes:t,thumbnailByGuid:eo,selectedNodeGuids:q,toggleSelectNode:er,showCollapsibleHeader:!0,observe:el})):l.createElement("div",{className:"post_to_feed_view--notFoundContainer--5cMl3 text--fontPos16--oMC-G text--_fontBase--QdLsd"},l.createElement("div",null,(0,E.tx)("fig_feed.no_frames_matching",{searchQuery:l.createElement(l.Fragment,null,l.createElement("span",{className:"post_to_feed_view--searchQuery--TIyhI"},B))})))))):null}},699321:(e,t,a)=>{a.r(t),a.d(t,{CreateFeedPostContent:()=>q,CreateFeedPostModal:()=>X,getUploadErrorMessage:()=>Z});var l=a(848318),o=a(716544),n=a(445777),r=a(157907),d=a(39773),i=a(536384),s=a.n(i),c=a(224223),m=a(193324),u=a(397579),f=a(857188),_=a(303035),p=a(427193),g=a(875856),E=a(757033),C=a(63571),b=a(145015),y=a(473889),h=a(280198),k=a(442313),I=a(697714),v=a(576220),N=a(110979),w=a(449737),S=a(87089),F=a(661780),x=a(825749),M=a(707717),T=a(850898),A=a(877297),D=a(438626),P=a(823888),O=a(318342),B=a(810968),L=a(295787),R=a(801092),K=a(583518),z=a(582538),U=a(853807),j=a(123714),W=a(89394),V=a(494874),G=a(611928);let Q=[O.My.CONTEXT_MENU,O.My.SHARE];function Z(e){switch(e.type){case T.Wn.MAX_UPLOADS_EXCEEDED:return(0,k.t)("fig_feed.too_many_content_items",e.params);case T.Wn.MAX_VIDEO_SIZE_EXCEEDED:return(0,k.t)("fig_feed.video_file_size_limit_MB",e.params);case T.Wn.MAX_IMAGE_SIZE_EXCEEDED:return(0,k.t)("fig_feed.image_file_size_limit_MB",e.params);case T.Wn.INVALID_FILE_TYPE:return(0,k.t)("fig_feed.unsupported_file_types_were_not_uploaded");case T.Wn.DUPLICATE_FILE_UPLOAD:return(0,k.t)("fig_feed.already_uploaded_items",e.params);case T.Wn.FAILED_TO_UPLOAD:return(0,k.t)("fig_feed.error_on_feed_post_creation");default:(0,n.xb)(e)}}function X(e){let t=(0,o.wA)(),a=(0,S.sZ)(),n=(0,D.R)(),r=l.useCallback(()=>{t(w.Ce())},[t]),d=(a?.name&&(0,k.tx)("fig_feed.post_to_org_feed",{orgName:a.name}))??(0,k.tx)("fig_feed.post_to_feed");return l.createElement(j.j,{title:d,onClose:()=>n(r)},l.createElement(q,{nodeInfo:e.nodeInfo,uploadInfo:e.uploadInfo,prototypeInfo:e.prototypeInfo,pageBackgroundColor:e.pageBackgroundColor,onSubmitSuccess:e.onSubmitSuccess,entryPoint:e.entryPoint,lockedFileKey:e.lockedFileKey}))}function q(e){let t=(0,o.wA)(),a=(0,S.sZ)(),n=(0,F.iZ)(),[i,X]=(0,d.fp)(D.T),[q,Y]=l.useState(!1),[J,$]=l.useState(!0),[H,ee]=l.useState(!1),[et,ea]=l.useState(!1),[el,eo]=l.useState((0,k.t)("fig_feed.title_input_placeholder")),[en,er]=l.useState(e.nodeInfo??null),ed=e.setMinimized,ei=l.useCallback(e=>{ed&&ed(e)},[ed]),es=(0,o.d4)(e=>e.modalShown),[ec,em]=l.useState((0,g.g)()),[eu,ef]=l.useState(0),e_=l.useCallback(()=>{eT(""),eD([]),ei(!0),ee(!1),eh([]),em((0,g.g)()),ef(0),er(null)},[ei]),ep=l.useCallback(()=>{t((0,w.to)({type:W.h,data:{onConfirm:e_},showModalsBeneath:!0}))},[t,e_]),eg=()=>{eo(A.ZP[Math.floor(Math.random()*A.ZP.length)]())};l.useEffect(()=>{eg()},[]);let eE=e.pageBackgroundColor,eC=en?.fileKey??e.prototypeInfo?.fileKey??"";l.useEffect(()=>{let t={entryPoint:e.entryPoint};eC&&(t.fileKey=eC),(0,c.sx)("Team Feed Create Post Modal Opened",t)},[e.entryPoint,eC]);let eb=l.useCallback((e,l)=>{if(l){t(w.Ce());return}let o={text:(0,k.t)("fig_feed.view_post"),action:()=>{t(N.V3({url:(0,P.Kc)(a.id,{uuid:e})}))}};t(I.F.enqueue({message:(0,k.t)("fig_feed.posted_to_org_feed",{orgName:a.name}),button:o})),t(w.Ce())},[t,a]),[ey,eh]=l.useState([]),ek=l.useMemo(()=>new Set(ey.map(e=>e.displayContentItem.type===A.cM.NODE?e.displayContentItem.nodeId:null).filter(e=>null!==e)),[ey]);l.useEffect(()=>{(0,L.sr)(en,ek,eh,a?.id,eE)},[en,ek,eh,a?.id,eE]);let eI=l.useRef(null);l.useEffect(()=>{let t=e.prototypeInfo;if(!a?.id||!t||eI.current)return;let l=(0,B.WI)(t,a.id);eI.current=l.displayContentItem,eh(e=>[...e.filter(e=>e.displayContentItem.type!==A.cM.PROTOTYPE),l])},[a?.id,e.prototypeInfo]);let ev=l.useCallback(e=>{let t=(0,z.K1)(ey[eu].displayContentItem);ef(e.findIndex(e=>(0,z.K1)(e)===t));let a=[];e.forEach(e=>{let t=(0,z.K1)(e),l=ey.find(e=>(0,z.K1)(e.displayContentItem)===t);l?a.push(l):console.error("Expected to have a matchedPendingItem")}),eh(a)},[ey,eu]),eN=l.useCallback(e=>{ef(ey.findIndex(t=>(0,z.K1)(t.displayContentItem)===e))},[ey]),{setContentPreview:ew,snapshotStates:eS}=(0,L.eh)(ey,eh),{onSubmitSuccess:eF}=e,ex=l.useCallback((a,l)=>{E.Ay.post("/api/feed_posts",a).then(a=>{Q.includes(e.entryPoint)?eb(a.data.meta.public_uuid,l):(e_(),eg()),l&&t(I.F.enqueue({message:(0,k.t)("fig_feed.post_submission_pending")})),eF&&eF(l)}).catch(()=>{t(h.s.error((0,k.t)("fig_feed.error_on_feed_post_creation"))),$(!1)})},[t,eb,eF,e_,e.entryPoint]),[eM,eT]=l.useState(""),[eA,eD]=l.useState([]),eP=l.useMemo(()=>({library:new M.M8(a.id)}),[a]);l.useEffect(()=>{$(eM.trim().length>K.Y||(0,m._Z)(eA).length>K.e||0===ey.length)},[eM,eA,ey.length]),l.useEffect(()=>{let e=eM.trim().length>0||!(0,m.I)(eA);Y(e||ey.length>0),X(e)},[eA,X,eM,ey.length]);let eO=e.lockedFileKey||en?.fileKey,eB=async l=>{let o=new p.M4;if(o.start(),(0,c.sx)("team_feed_onsubmit",{currentOrgPresent:!!a,submitDisabled:J},{logFromProber:!0}),!a||J)return;l?.preventDefault(),$(!0);let n={description_meta:eA,org_id:a.id};n.background_color=eE;let r=(0,m._Z)(eA);n.content=await (0,B.pj)(t,ey,eC,eM),(0,c.sx)("team_feed_content_awaited",{payloadContent:JSON.stringify(n.content)},{logFromProber:!0});let d=n.content.some(e=>e.pending);n.uuid=ec,eM?n.title=eM:n.title=r.length>0?r.slice(0,40)+"\u2026":(0,k.t)("fig_feed.untitled_post"),eO&&(n.attached_file_key=eO),ex(n,d),o.stop(),(0,c.sx)("team_feed_click_to_post_latency",{elapsedTimeMs:o.getElapsedTime()},{forwardToDatadog:!0}),(0,c.sx)("Team Feed New Post Submitted",{fileKey:eC,entryPoint:e.entryPoint,text:r,numContentItems:n.content.length,contentItemTypes:n.content.map(e=>e.type)},{forwardToDatadog:!0})},eL=l.useCallback((e,l)=>{if(!a)return;let o=Array.from(e);if(0===o.length)return;let n=(0,x.KT)(o,ey.length,A.e3,A.bB,e=>{t(I.F.enqueue({message:Z(e)}))},ey.map(e=>e.fileIdentifier)).map(e=>{let t=(0,x.Fn)(e);if(T.xp.includes(e.type))return(0,B.zr)(t,e);if(T.VY.includes(e.type))return(0,B.X2)(t,ec,a.id,e);throw Error("unexpected file type")}),r=void 0!==l?l:ey.length;eh(e=>[...e.slice(0,r),...n,...e.slice(r)]),ef(r)},[t,a,ec,ey]),eR=l.useCallback((e,t)=>()=>{let a=e.current?.files||null;null!==a&&0!==a.length&&(eL(a,t),ei(!1),e.current&&(e.current.value=""))},[eL,ei]),eK=(0,u.ZC)(e.uploadInfo);l.useEffect(()=>{e.uploadInfo&&e.uploadInfo!==eK&&(ei(!1),eL(e.uploadInfo))},[e.uploadInfo,eK,ei,eL]);let ez=l.useCallback(e=>{let t=Math.min(e,Math.max(0,ey.length-2)),a=ey[e];if((0,B.AK)(a),eh(t=>t.filter((t,a)=>a!==e)),a.displayContentItem.type===A.cM.NODE){let e=a.displayContentItem.nodeId;er(t=>{if(t){let a=t.nodeIds.filter(t=>t!==e),l=t.nodeThumbnails,o=l&&a.reduce((e,t)=>(e[t]=l[t],e),{});return{...t,nodeIds:a,nodeThumbnails:o}}return null})}ef(t)},[ey]),eU=l.useCallback((e,t)=>{eL(e.files,t),ea(!1)},[eL]),ej=l.useRef(null),eW=!!en?.nodeIds?.length,{openPostFromFileModal:eV,attachedFileData:eG}=(0,L.Ld)({setLinkedFileNodeInfo:er,numUserContentItems:ey.length,hasNodeContent:eW,parentModalRef:ej,attachedFileKey:eO,lockedFileKey:e.lockedFileKey,currentOrgId:a?.id}),eQ=l.useCallback(()=>{let e=ey.map(e=>e.displayContentItem);return l.createElement(C.Y,{className:s()(G.xe,et&&G.w8),isDragTarget:()=>!0,onTargetDragEnter:()=>ea(!0),onTargetDragLeave:()=>ea(!1),onTargetDrop:e=>eU(e)},l.createElement(z.Zo,{contentItems:e,staticContent:!0,scrollable:!1,deleteItemAtIdx:H?void 0:ez,pageBackgroundColor:eE,onReorderCallback:H?void 0:ev,shouldScrollToIndex:null,selectedIdx:eu,setSelectedIdx:ef,onFileInputChange:eR,setSelectedContent:eN,snapshotStates:eS,setContentPreview:ew,openPostFromFileModal:eV,attachedFile:eG,dragging:et,mode:"create"}))},[eE,et,ev,ez,H,ey,eU,eu,eR,eN,eS,ew,eV,eG]),eZ=l.useCallback(e=>{e.keyCode===f.Uz.ESCAPE&&ei(!0)},[ei]),eX=l.useCallback(()=>{es||(q&&(eT(e=>e.trim()),(0,m.I)(eA)&&eD([])),ei(!0))},[eA,ei,es,q]),eq=l.useCallback(()=>{eX(),t(w.Ce())},[t,eX]),eY=l.createElement("div",{className:s()(G.zE,i&&G.ku),onKeyDown:e.disabled?_.lQ:eZ,role:"textbox",tabIndex:0,onClick:()=>!e.disabled&&ei(!1)},n&&l.createElement("div",{className:G.y3},l.createElement(U.A,{user:n,size:v.Pf.LARGE})),l.createElement("div",{className:G.lt},l.createElement("div",{className:G.KG},l.createElement("div",{className:G.aF},l.createElement("div",{className:G.yD},eM||el," ",eM&&l.createElement("span",{className:G.Fd},(0,k.t)("fig_feed.draft")))),l.createElement("div",{className:G.wg},l.createElement(b.$$,{disabled:!0,dataTestId:"feed-post-post"},(0,k.tx)("fig_feed.post")))))),eJ=l.createElement("div",{className:G.RO,onKeyDown:eZ,role:"textbox",tabIndex:0,onClick:()=>ei(!1),ref:ej},l.createElement("div",{className:G.q3},eQ(),a&&n?l.createElement("div",{className:G.DA},l.createElement(R.FeedPostUnifiedComposer,{user:n,currentOrgId:a.id,autofocus:!0,mentionables:eP,onSubmit:J?void 0:eB,submitOnEnter:!1,hideSubmitButton:!0,description:eA,updateDescription:eD,title:eM,updateTitle:eT,displayDecoratorsDownwards:!0,minimized:e.minimized,readOnly:H,editableTypeaheadClass:V.up,openPostFromFileModal:()=>eV({skipFrameSelection:!eW}),fileData:eG,lockFileAddition:ey.length>=A.e3,parentRef:ej,canUnlinkFile:!eW&&!e.lockedFileKey,unlinkFile:()=>er(null)})):null),l.createElement("div",{className:G.CQ},l.createElement("div",{className:G.UD},!Q.includes(e.entryPoint)&&(q?l.createElement(b.nR,{onClick:e=>{e.stopPropagation(),ep()}},(0,k.tx)("fig_feed.discard_draft")):l.createElement(b.nR,{onClick:e=>{e.stopPropagation(),e_()}},(0,k.tx)("general.cancel"))),l.createElement(b.$$,{onClick:e=>{if(!H)return ee(!0),eB(e).finally(()=>{ee(!1)})},disabled:J,dataTestId:"feed-post-post",className:H?G.zb:G.pb},H&&l.createElement("div",{className:G.YI},l.createElement(y.kt,{shouldMatchTextColor:!0,size:"medium"})),H?(0,k.tx)("fig_feed.posting"):(0,k.tx)("fig_feed.post"))))),e$=(a?.name&&(0,k.tx)("fig_feed.post_to_org_feed",{orgName:a.name}))??(0,k.tx)("fig_feed.post_to_feed");return a&&n&&(0,r.k)().xr_debounce_threshold?e.entryPoint===O.My.FEED_HEADER?l.createElement(l.Fragment,null,eY,!e.minimized&&l.createElement(j.j,{title:e$,onClose:eq},eJ)):eJ:null}},123714:(e,t,a)=>{a.d(t,{j:()=>d});var l=a(848318),o=a(197933),n=a(314272),r=a(243023);function d(e){return l.createElement(o.i,{displayAs:o.C.Block},l.createElement(n.XV,{title:l.createElement("div",{className:"feed_modal_base--title--HN9jR"},e.title),maxWidth:r.b,minWidth:r.X,fixedTop:!1,onClose:e.onClose,headerClassName:"feed_modal_base--header--gAhz4",closeOnEsc:!0},e.children))}},295787:(e,t,a)=>{a.d(t,{sr:()=>W,eh:()=>G,Ld:()=>V});var l=a(848318),o=a(891627),n=a(716544),r=a(980399),d=a(442313),i=a(697714),s=a(449737),c=a(927813),m=a(997894),u=a(877297),f=a(810968),_=a(582538),p=a(445777),g=a(195237),E=a(536384),C=a.n(E),b=a(666428),y=a(922976),h=a(303035),k=a(266163),I=a(473889),v=a(575492),N=a(661780),w=a(918105),S=a(503024),F=a(464012),x=a(962465),M=a(543532),T=a(246633),A=a(314272),D=a(808123);let P="post_from_file_modal--grid--JdmAi",O="post_from_file_modal--searchLoadingSpinnerContainer---qSgU post_from_file_modal--loadingSpinnerContainer--QaXkG";var B=a(564422);let L=`https://${window.location.host}`;var R=(e=>(e[e.SELECT_FILE=1]="SELECT_FILE",e[e.SELECT_NODE=2]="SELECT_NODE",e))(R||{});function K(e){let t=l.useRef(null),a=(0,N.TA)(),o=encodeURIComponent(`${e.selectedFile.url}?fuid=${a}&post-to-feed=1&force-incremental=0`),n=`${L}/embed?integration_host=fig-feed&url=${o}`,[r,i]=l.useState(!1),[s,c]=l.useState([]);l.useEffect(()=>{let e=e=>{if(window.parent.origin!==e.origin)return;let{type:t,data:a}=e.data;t===M.v.LOADED&&i(()=>!0),t===M.v.SELECT_NODE&&c(()=>a??[])};return window.addEventListener("message",e),()=>{window.removeEventListener("message",e)}},[]);let m=s.length>0;return l.createElement(l.Fragment,null,!r&&l.createElement("div",{className:"post_from_file_modal--embedLoadingSpinnerContainer--x0E-V post_from_file_modal--loadingSpinnerContainer--QaXkG"},l.createElement(I.kt,{size:"large"})),l.createElement("iframe",{ref:t,className:"post_from_file_modal--iframe--W8QSR",title:"Figma",src:n,scrolling:"no"}),l.createElement("div",{className:"post_from_file_modal--footer--UhneR"},l.createElement(k.$$,{onClick:t=>{t.stopPropagation(),e.setNodeInfo({fileKey:e.selectedFile.key,nodeIds:s.map(e=>e.guid),nodeThumbnails:s.reduce((e,{guid:t,thumbnail:a})=>{let l=new Blob([a]),o=URL.createObjectURL(l);return{...e,[t]:o}},{}),backgroundColorByNode:s.reduce((e,{guid:t,backgroundColor:a})=>a?{...e,[t]:a}:e,{})}),e.hideModal?.()},disabled:!m},(0,d.tx)("fig_feed.add_to_post"))))}function z(e){let t=(0,b.ql)(e.orgId),a=g.Qw.useTransformShallowEqual(t,e=>e.filter(e=>e.can_edit)),o="loaded"===a.status,{setSelectedFile:n,onAfterSelect:r}=e,i=l.useCallback(e=>{n(e),r()},[n,r]),[s,c]=l.useState(""),[m,u]=l.useState(null),f=l.useMemo(()=>m?.map(e=>e.model.key)??[],[m]),_=(0,y.IT)(f),p=l.useMemo(()=>null===m?null:"loaded"===_.status?m.filter(e=>_.data[e.model.key]?.canEdit):null,[_,m]),E=l.useCallback(e=>l.createElement("div",{className:"post_from_file_modal--tileContainer--f1mpx",onClick:()=>{i(e)},role:"button",tabIndex:0,key:`tile-${e.key}`},l.createElement("div",{className:"post_from_file_modal--chooseFile--3ABxf"},(0,d.t)("fig_feed.choose_file")),l.createElement(D.GQ,{file:e,currentUser:null,activeFileUsers:[],subtitle:l.createElement(D.lJ,{file:e}),onClick:h.lQ})),[i]),C=l.useMemo(()=>s?p?0===p.length?l.createElement("div",{className:"post_from_file_modal--notFoundContainer--JLJWT text--fontPos16--oMC-G text--_fontBase--QdLsd"},l.createElement("div",null,(0,d.tx)("community.universal_posting_modal.recent_editable_files_search.no_files_matching",{searchQuery:l.createElement(l.Fragment,null,l.createElement("span",{className:"post_from_file_modal--searchQuery--GpUQJ"},s))}))):l.createElement(v.P,{hideScrollbar:!0},l.createElement("div",{className:P},p.map(e=>E(e.model)))):l.createElement("div",{className:O},l.createElement(I.kt,{size:"large"})):a.data&&l.createElement(v.P,{hideScrollbar:!0},l.createElement("div",{className:P},a.data.map(e=>E(e)))),[a.data,p,s,E]),k=l.useCallback(e=>{u(e.map(e=>({...e,model:{...w.F.toSinatra(e.model),fileRepo:e.model.fileRepo,fragments:e.model.fragments,owner:e.model.owner}})))},[u]);return o?l.createElement(l.Fragment,null,l.createElement("div",{className:"post_from_file_modal--searchContainer--oiMYX"},l.createElement(x.IW,{query:s,setQuery:c,setSearchResults:k,placeholderText:(0,d.t)("fig_feed.search_files")})),C):l.createElement("div",{className:O},l.createElement(I.kt,{size:"large"}))}function U(e){let{setModalPage:t,orgId:a,setSelectedFile:o}=e;return l.createElement(z,{orgId:a,setSelectedFile:o,onAfterSelect:e.skipFrameSelection?e.hideModal:()=>{t?.(2)}})}let j=(0,F.Ju)(function(e){let t=(0,n.wA)(),a=()=>{t(s.Lo()),e.parentRef?.current?.focus()},[o,r]=l.useState(e.attachedFile),[i,c]=l.useState(e.lockFileSelection||e.attachedFile?2:1),{setFeedPostNodeInfo:m}=e,u=l.useCallback(e=>{r(e),m({fileKey:e.key,nodeIds:[]})},[m]),f=e=>c(()=>e);return l.createElement(A.XV,{title:(()=>{switch(i){case 1:return(0,d.t)("fig_feed.choose_a_file");case 2:return l.createElement("div",{className:C()("post_from_file_modal--leftButtonGroup--ZT4p5",e.lockFileSelection&&"post_from_file_modal--headerPadding--6G68d")},!e.lockFileSelection&&l.createElement(T.K0,{svg:B.A,onClick:()=>f(1),"data-tooltip":(0,d.t)("fig_feed.button.back"),"data-tooltip-type":S.Ib.TEXT})," ",o?.name??"");default:(0,p.xb)(i)}})(),onClose:a,containerClassName:"post_from_file_modal--modalView--qMQ2p",innerContainerClassName:"post_from_file_modal--innerModalView--CfMj1",disableClickOutsideToHide:!0,maxWidth:1===i?1024:680,closeOnEsc:!0},(()=>{switch(i){case 1:return l.createElement(U,{orgId:e.orgId,setModalPage:f,setSelectedFile:u,hideModal:a,skipFrameSelection:e.skipFrameSelection});case 2:if(!o)return null;return l.createElement(K,{selectedFile:o,hideModal:a,setNodeInfo:e.setFeedPostNodeInfo});default:(0,p.xb)(i)}})())},"PostFromFileModal");function W(e,t,a,l,n){if(!l||!e)return;let r=e.nodeIds.filter(e=>!t.has(e));0!==r.length&&(queueMicrotask(()=>{(0,o.flushSync)(()=>{a(t=>[...t,...(0,f.Px)(e.fileKey,r,l)])})}),(0,f.Rl)(e.fileKey,r,l,n,e.nodeThumbnails,e.backgroundColorByNode).then(e=>{a(t=>t.map(t=>t.displayContentItem.type===u.cM.NODE&&t.displayContentItem.isLoading?e[t.displayContentItem.nodeId]:t))}))}function V(e){let{setLinkedFileNodeInfo:t,numUserContentItems:a,hasNodeContent:o,parentModalRef:r,attachedFileKey:c,lockedFileKey:f,currentOrgId:_}=e,p=(0,n.wA)(),g=m.M4.useFile(c).data,E=l.useCallback(e=>{if(!f||e.fileKey===f){if(e.nodeIds.length+a>u.e3){p(i.F.enqueue({message:(0,d.t)("fig_feed.too_many_content_items",{maxNum:u.e3})}));return}t(t=>{let a=e.nodeIds,l=e.nodeThumbnails,o=e.backgroundColorByNode;return t&&e.fileKey===t.fileKey?{fileKey:t.fileKey,nodeIds:[...new Set(t.nodeIds.concat(a))],nodeThumbnails:{...t.nodeThumbnails,...l},backgroundColorByNode:{...t.backgroundColorByNode,...o}}:{fileKey:e.fileKey,nodeIds:a,nodeThumbnails:l,backgroundColorByNode:o}})}},[p,a,f,t]);return{openPostFromFileModal:l.useCallback(e=>{_&&p((0,s.to)({type:j,data:{orgId:_,setFeedPostNodeInfo:E,attachedFile:g,parentRef:r,lockFileSelection:f||g&&o,skipFrameSelection:e?.skipFrameSelection}}))},[p,_,E,g,f,o,r]),attachedFileData:g}}function G(e,t){return{setContentPreview:l.useCallback((a,l,o)=>{let n=Array.from(e),d=n.findIndex(e=>(0,_.K1)(e.displayContentItem)===a),i=n[d];if(i&&(0,u.aT)(i.displayContentItem)){i.preview={url:l,state:o};let e=i.displayContentItem;e.preview_image_url=l,e.backgroundColor=(0,r.colorToHex)(o.backgroundColor),t(n)}else console.error("expected to find matched content item")},[e,t]),snapshotStates:l.useMemo(()=>e.reduce((e,t)=>(t.preview?e[(0,_.K1)(t.displayContentItem)]=t.preview.state:(0,f.EU)(t.displayContentItem)&&(e[(0,_.K1)(t.displayContentItem)]={x:t.displayContentItem.initialX,y:t.displayContentItem.initialY,zoom:t.displayContentItem.initialZoom,ratio:1,backgroundColor:(0,c.dy)(t.displayContentItem.backgroundColor)}),e),{}),[e])}}}}]);

//# debugId=37c36760-a2c1-5a52-a7ac-f197818501a4

//# sourceMappingURL=https://admin.figma.com/admin/webpack-artifacts/5afb9983c7fca4b081dcbc19c34eb534bed31704/9321-f84da2c03942e2e9.min.js.map